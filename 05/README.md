# Домашнее задание к занятию "5.1. Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения."
[Источник](https://github.com/netology-code/virt-homeworks/blob/virt-11/05-virt-01-basics/README.md)

## Задача 1

> Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.

Виртуализация в данном случае - это возможность на одной физической машине запустить несколько 
изолированных друг от друга окружений, каждое из которых обладает характеристиками 
физического компьютера (процессор, оперативная память, сети, диски).

Реализации этой возможности бывают разными.

При **полной виртуализации** эмулируется всё аппаратное обеспечение. За счет этого в такой среде 
может быть запущена практически любая ОС. При использовании такая виртуальная машина неотличима 
от физической (ОС не значет о том, что она запущена в виртуальной среде). Ядро ОС, запущенной 
в полностью виртуальном окружении, имеет неограниченный доступ к своему процессору. 
Достоинство полной виртуализации в том, что она дает высокую степень автономности виртуальных 
машин, в том числе независимость от архитектуры физической машины.  
Одно из ограничений такого подхода в том, что он требует специального железа на физической 
машине и соответствующего ПО, совместимого с этим железом и позволяющего создавать 
такие автономные среды. Это дорого, а также специфика оборудования сужает сферу применения 
такого сервера. Еще одно ограничение в том, что полная виртуализация очень требовательна 
в плане ресурсов.  
**Итого: физические ресурсы заранее поделены, у каждой виртуальной машины своя неизменная среда, 
на виртуальных машинах устанавливаются полноценные операционные системы.**

**Паравиртуализация**, в отличие от полной, не предполагает эмуляции всего обеспечения. Вместо 
обращения к своим автономным ресурсам, ОС, запущенная в такой виртуальной среде 
(гостевая ОС), в случае необходимости обращается к хозяйской (host) ОС через определенный интерфейс, 
предоставляемый гипервизором - программной прослойкой, обеспечивающей виртуализацию. 
Гостевая ОС знает о том, что она работает на виртуальной машине. Поэтому она не пытается 
обращаться напрямую к физическим ресурсам (или имитации таковых), а запрашивает нужные 
системные функции у машины-хозяина.  
Это решение менее требовательно к специальным условиям и оттого более гибкое. Одна из возможных 
проблем в том, что гостевые системы, не имея заранее выделенных для них аппаратных 
ресурсов, обращаются к одним и тем же ресурсам хозяина, и если их окажется недостаточно, 
их производительность снизится.  
**Итого: на каждой виртуальной машине полноценная полностью изолированная ОС, но физические 
ресурсы для них заранее не поделены. Гостевые ОС получают все ресурсы от ОС-хозяина и таким 
образом потенциально конкурируют за них**.

**Виртуализация на основе ОС** (контейнерная виртуализация). Если в первых двух случаях каждая 
виртуальная машина содержала в себе операционную систему целиком, то есть 
прежде всего ее ядро, то в данном случае виртуализация происходит уровнем выше. Строго говоря, 
при такой виртуализации операционная система одна (ядро одно). Над ней располагаются изолированные 
среды, в которых могут автономно работать приложения, не мешая друг другу. Достоинство такого 
подхода в том, что он решает задачу изоляции приложений друг от друга без ненужной избыточности. 
Закономерное ограничение в том, что в разных контейнерах на одной ОС всегда будет одно и 
то же ядро. То есть используя только такой тип виртуализации на одной машине нельзя 
запустить одно приложение в окружении Linux, а другое - окружении Windows.  
**Итого: в каждом контейнере свой набор установленных зависимостей, свои версии и всё, что 
необходимо для работы данного приложения. Но всё это работает на базе одного и того же ядра ОС, 
в которой запущены эти контейнеры**.  
([хорошее краткое иллюстративное пояснение про контейнеры](https://www.quora.com/Can-I-run-Windows-OS-in-Docker/answer/Balakrishnan-32))

## Задача 2

> Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования.

> Организация серверов:
> - физические сервера,
> - паравиртуализация,
> - виртуализация уровня ОС.

> Условия использования:
> - Высоконагруженная база данных, чувствительная к отказу.
> - Различные web-приложения.
> - Windows системы для использования бухгалтерским отделом.
> - Системы, выполняющие высокопроизводительные расчеты на GPU.

Опишите, почему вы выбрали к каждому целевому использованию такую организацию.

|-|физические сервера|паравиртуализация|виртуализация уровня ОС|
|---|---|---|---|
|Высоконагруженная база данных, чувствительная к отказу|Здесь главное сохранность данных и скорость обработки запросов. Наиболее очевидное решение - кластер физических серверов с репликами базы|-|-|
|Различные web-приложения|-|-|Сами приложения много места не занимают, но при этом обычно требуют разной среды, и нужна возможность их быстро разворачивать и перезапускать. Для этого удобна контейнеризация|
|Windows системы для использования бухгалтерским отделом|-|Здесь важна, прежде всего, сохранность настроек и рабочего состояния. А также, вероятно, непрерывность работы. Подходящим решением представляется паравиртуализация с использованием Microsoft Hyper-V, который умеет в случае отказа хоста мигрировать виртуальную машину на другой хост в реальном времени|-|
|Системы, выполняющие высокопроизводительные расчеты на GPU|Не случалось сталкиваться, но, судя по формулировке, в данном случае главное действующее лицо здесь - железо, и дополнительные прослойки в виде виртуализации здесь большого смысла не имеют. Поэтому, видимо, физические сервера.|-|-|

## Задача 3

> Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

> Сценарии:

> 1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
> 2. Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
> 3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.
> 4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.


1. Либо VMware, либо Hyper-V. Оба умеют перераспределять нагрузку и имеют множество возможностей 
настройки. С учетом того, что преобладает Windows, наверно, имеет смысл выбрать Microsoft Hyper-V 
как более родной.  
2. KVM. В принципе под критерий бесплатности подходит Hyper-V, но он проприетарный.  
3. Кажется, лучше всего подходит Hyper-V.  
4. Зависит от того, как уже организован сервер для тестирования. Хороший вариант, где нет 
ничего лишнего, - использовать Docker (то есть контейнеризацию), но если на сервере уже есть 
отработанный механизм рутинного создания виртуальных машин с нужными дистрибутивами, то 
эта готовая среда может быть вполне пригодной (VirtualBox, продукты VMware и подобные).

## Задача 4

> Опишите возможные проблемы и недостатки гетерогенной среды виртуализации 
>(использования нескольких систем управления виртуализацией одновременно) и что необходимо 
>сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы 
>гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

Серьезная проблема в том, что каждая система витруализации требует компетентного 
сопровождения и обслуживания. Это требует как квалификации, так и времени на поддержание 
(то есть рабочих рук). Для гомогенной среды, в зависимости от ее масштабов, достаточно 
одного специалиста или одной специализированной команды. Если систем становится больше, 
то возникает необходимость либо в фундаментальном расширении квалификации имеющихся 
специалистов, либо привлечение новых кадров на обслуживание второй системы (второе 
более вероятно с учетом неизбежных временных затрат).

Еще одна проблема в том, что вписывание гетерогенной среды в общую инфраструктуру будет 
более трудоемким. В частности, довольно трудно будет настроить единый для всех мониторинг, 
механизмы резервного копирования, поддержку. Фактически это потребует создание дополнительной прослойки 
виртуализации, которая бы позволяла настраивать общие для разнородных систем функции в последовательном 
единообразном виде. Создание такой прослойки само по себе представляется задачей уровня 
разработки рыночного продукта. Альтернатива ей - несистематические решения, которые довольно 
быстро приведут к хаосу, который невозможно поддерживать.

Таким образом, в общем случае гомогенная среда представляется более удобным удобным выбором. 
Однако можно представить себе ситуации, в которых создание гетерогенной среды уместно либо 
неизбежно. Например, случаи интеграции продукта с собственной развитой и специфической 
инфраструктурой в другую среду, работающую принципиально иначе. Если новый продукт поступил с 
прилагающейся к нему командой и собирается дальше жить своей автономной жизнью, 
пусть и в составе более обширной инфраструктуры, то оптимальный вариант - просто оставить ему 
его автономность, благо на его сопровождение, включая обслуживание системы виртуализации, 
у него уже есть команда. В этом случае, конечно, желательно выделить команде и свой серверный 
кластер, чтобы она там настроила гомогенную среду по своему усмотрению.

Другая ситуация: относительно молодая небольшая компания хочет усовершенствовать свою 
инфраструктуру, в том числе с помощью виртуализации. На ранних этапах имеет смысл попробовать 
несколько технологий, чтобы примерно понять возможности и ограничения и по итогам принять 
решение о том, во что вкладываться. С вероятностью, эксперименты будут происходить на 
одной физической машине, что, потребует некоторых усилий по организации гетерогенной среды. Вариант - 
найти всё-таки разные машины или распределить эксперименты по времени так, чтобы на физической 
машине за раз работал только один гипервизор.

Еще ситуация: долгое время инфраструктура существовала преимущественно на продуктах Microsoft, 
но затем было принято решение о необходимости перехода на Linux и опенсорсное ПО. Это 
значит, что потребуется и смена системы виртуализации. Если инфраструктура большая, то такой 
переход придется совершать по частям, то есть некоторое время придется мириться с 
гетерогенной средой.
