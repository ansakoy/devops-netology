# Домашнее задание к занятию "5.2. Применение принципов IaaC в работе с виртуальными машинами"
[Иcточник](https://github.com/netology-code/virt-homeworks/blob/virt-11/05-virt-02-iaac/README.md)

## Задача 1

> - Опишите своими словами основные преимущества применения на практике IaaC паттернов.

О главном преимуществе говорит само слово "паттерн". В противоположность 
практике каждый раз задавать конфигурации вручную применение паттернов позволяет 
многократно использовать единожды подготовленные стандартные описания. Стандартизация этих описаний, 
в свою очередь, дает возможность их упорядочивать и комбинировать между собой. Применение паттернов 
дает преимущества как в плане скорости, так и в плане качества, а именно:
* если один раз настроить и отладить инфраструктуру, то впоследствии ту же конфигурацию 
можно применять с минимальными изменениями для аналогичных деплоев. То есть (1) не нужно писать 
заново, (2) не нужно заново отлаживать, (3) внесение изменений производится стандартным и 
предсказуемым образом, что снижает риск ошибки и упрощает дебаггинг.
* одна и та же среда с легкостью воспроизводится на разных машинах, что позволяет вести 
разработку и проверять ее результаты как локально, так и на удаленных машинах (тестовые, 
демонстрационные и продуктовые среды практически идентичны, то есть если проверено в 
одном месте, работать будет и в другом) -> скорость и качество тестирования, скорость выявления 
ошибок, упрощение параллельной разработки
* из предыдущего следует ускорение продуктового деплоя, в том числе возможность поэтапной (модульной) 
реализации продукта -> продуктом раньше начинают пользоваться -> выявляются практические 
пожелания по усовершенствованию -> усовершенствования технически могут добавляться, 
тестироваться и выводиться в продуктовый деплой с минимальным отставанием от поступления 
пожеланий

В целом применение паттернов - это условие для автоматизация, а 
применяемая с умом автоматизация позволяет минимизировать риски человекоошибок и избегать 
повторной ручной работы.

> - Какой из принципов IaaC является основополагающим?

Принцип идемпотентности, то есть воспроизводимости идентичных результатов при повторе одной 
и той же операции.

## Задача 2

> - Чем Ansible выгодно отличается от других систем управление конфигурациями?

Практически ни с чем, кроме ансибла, дела иметь не случалось. Судя по лекции, главное преимущество 
в быстром старте использования. Ансибл не требует предварительной подготовки к использованию, 
так как использует готовую инфраструктуру SSH, в отличие от аналогов, требующих развертывания 
специальной PKI (Private Key Infrastracture). (Правда, остается вопрос, какой ценой дается 
это преимущество и что теряется, если теряется, за счет отсутствия специальной PKI.)

Также, с точки зрения разработчика на питоне, очень удобно, что ансибл сам написан на 
питоне (в отличие от того же Puppet), то есть его можно установить в виртуальное окружение конкретного 
проекта и все конфиги задавать внутри этого окружения для данного конкретного проекта 
(без необходимости глобальной установки, что дает больше гибкости в версионировании 
зависимостей в проектах).

> - Какой, на ваш взгляд, метод работы систем конфигурации более надёжный push или pull?

Очень зависит от конкретных условий и требований. На практике доводилась работать только с push. 
Возможно, от этого есть некоторая предвзятость в его пользу. Однако сфера применения 
ограничивалась только выкатом обновлений проекта по мере его разработки. С этой точки зрения, 
удобно, когда инициатива апдейта исходит от управляющей машины (я знаю, что изменения есть, 
я хочу из выкатить, мне не надо для этого выходить на удаленный сервер, я просто 
даю команду выката).  
Потенциальные недостатки в том, что для push необходимо, чтобы управляющая машина знала, куда 
отправлять изменения, то есть целевой адрес должен быть известен и прописан. Если он постоянно 
меняется, могут возникнуть трудности. В отличие от адреса деплоя, адрес того места, к которому 
бы обращался за обновлениями сервер через pull, может быть более стабильным.  
Также зависит от настроек файерволла на сервере. Можно представить ситуацию, при которой 
серверу лучше вообще не принимать push запросы, а только обращаться к источнику по своей 
инициативе.  
В целом из обсуждений вопроса в Сети складывается впечатления, что у этих методов немного 
разные сферы применения. Pull удобен в тех случаях, когда внешние изменения и жизнь конкретного 
продукта на сервере автономны. Например, изменение определенных пакетов в apt можно учитывать 
или игнорировать на стороне конкретного сервера. То есть сервер сам обратится за обновлениями 
тогда, когда это будет наиболее удобно. Если изменения определяют саму суть продукта на сервере 
и принципиально меняют его, то инициатива с большей вероятностью должна исходить от 
управляющей машины.

## Задача 3

> Установить на личный компьютер:

> - VirtualBox
> - Vagrant
> - Ansible

[Устанавливающий скрипт](installations.sh)  
[Логи с -euxo](logs/task3.log)

> *Приложить вывод команд установленных версий каждой из программ, оформленный в markdown.*

Vagrant
```
$ vagrant --version
Vagrant 2.2.19
```
Ansible
```
$ ansible --version
ansible [core 2.12.2]
  config file = None
  configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/local/lib/python3.8/dist-packages/ansible
  ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections
  executable location = /usr/local/bin/ansible
  python version = 3.8.10 (default, Nov 26 2021, 20:14:08) [GCC 9.3.0]
  jinja version = 2.10.1
  libyaml = True
```
Virtualbox
```
$ vboxmanage --version
6.1.26_Ubuntur145957
```

## Задача 4 (*)

> Воспроизвести практическую часть лекции самостоятельно.

> - Создать виртуальную машину.

[Vagrantfile](vagrant/Vagrantfile)  
[Ansible playbook](ansible/playbook.yml)

[Лог установки](logs/task4.log)

Примечания:
1. ssh ключа действительно не было, задачу ансибл проигнорировал, как заказывали
1. with_items устарело, лучше не использовать в плейбуках

> - Зайти внутрь ВМ, убедиться, что Docker установлен с помощью команды
```
docker ps
```

```
$ vagrant ssh
Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sun 06 Feb 2022 09:34:39 PM UTC

  System load:  0.07               Users logged in:          0
  Usage of /:   13.4% of 30.88GB   IPv4 address for docker0: 172.17.0.1
  Memory usage: 23%                IPv4 address for eth0:    10.0.2.15
  Swap usage:   0%                 IPv4 address for eth1:    192.168.192.11
  Processes:    111


This system is built by the Bento project by Chef Software
More information can be found at https://github.com/chef/bento
Last login: Sun Feb  6 21:30:07 2022 from 10.0.2.2
vagrant@server1:~$ docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
```