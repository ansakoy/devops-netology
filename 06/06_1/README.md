# Домашнее задание к занятию "6.1. Типы и структура СУБД"

[Источник](https://github.com/netology-code/virt-homeworks/blob/virt-11/06-db-01-basics/README.md)

## Задача 1

>Архитектор ПО решил проконсультироваться у вас, какой тип БД 
>лучше выбрать для хранения определенных данных.
>
>Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:
>
>- Электронные чеки в json виде
>- Склады и автомобильные дороги для логистической компании
>- Генеалогические деревья
>- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации
>- Отношения клиент-покупка для интернет-магазина
>
>Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

- Электронные чеки в json виде. Хорошо хранить в документоориентированной БД. Тут не 
требуется сложных связей, а производительность хорошая. Риск, что появится чек, который 
по размеру не влезет в документ, минимален. Подход к структурированию записей 
в документоориентированной БД тот же, что в записях JSON, что делает выбор естественным. 
- Склады и автомобильные дороги для логистической компании. Логистическая тематика, 
скорее всего, предполагает интерес к выявлению оптимальных маршрутов. Для таких 
задач должны подходить графовые БД.
- Генеалогические деревья. Иерархические БД структурно соответствуют и, по всей 
видимости, обеспечивают оптимальный поиск по таким структурам, в отличие от, например, 
реляционных. Вероятно, в зависимости от специфики генеалогий также подходят 
сетевые БД.
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации. 
Для хранения кэша обычно используются базы типа ключ-значение.
- Отношения клиент-покупка для интернет-магазина. Реляционная БД. Предметная область 
располагает к тому, чтобы представляеть ее в виде связанных таблиц, обеспечивающих 
необходимую нормализацию и консистентность данных.

## Задача 2

>Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
>CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
>(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):
>
>- Данные записываются на все узлы с задержкой до часа (асинхронная запись)
>- При сетевых сбоях, система может разделиться на 2 раздельных кластера
>- Система может не прислать корректный ответ или сбросить соединение
>
>А согласно PACELC-теореме, как бы вы классифицировали данные реализации?

>- Данные записываются на все узлы с задержкой до часа (асинхронная запись)

PA (система доступна постоянно, но обновление узлов происходит с задержкой, 
то есть в произвольный момент времени система может оказаться неконсистентной)

PA/EL (при разделении доступна / иначе восстановление консистентности с задержкой)

>- При сетевых сбоях, система может разделиться на 2 раздельных кластера

PA (в условиях разделения все части системы остаются доступными в ущерб 
консистентности, которую после восстановлении связи придется восстанавливать)

PA/EL (при разделении доступна / иначе восстановление консистентности с задержкой)

>- Система может не прислать корректный ответ или сбросить соединение

PC (в условиях сбоя система становится недоступной, сохраняя тем самым 
консистентность)

PC/EC (при разделении стремится к сохранению консистентности, иначе хранит консистентность)

## Задача 3

>Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

В полноценном виде едва ли могут, потому что эти принципы ставят противоположные, 
с точки зрения CAP, приоритеты. Для ACID приоритет - консистентность. Для BASE - 
доступность. Согласно CAP, одна система неизбежно будет следовать только  
одному из этих принципов.

## Задача 4

>Вам дали задачу написать системное решение, основой которого бы послужили:
>
>- фиксация некоторых значений с временем жизни
>- реакция на истечение таймаута
>
>Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). 
>Что это за система? Какие минусы выбора данной системы?

Если задача только в том, чтобы фиксировать значения с TTL и реагировать на истечение 
таймаута, не очень понятно, причем тут именно pub/sub. Пример популярного хранилища, отвечающего 
указанным критериям, - это Redis, который может, конечно, использоваться в качестве брокера 
сообщений и даже имеет встроенный механизм pub/sub, но для применения этого механизма 
в поставленных условиях основания нет. Наверно, он тут упоминается просто для того, чтобы 
описательно навести на мысль, что речь идет о Redis.

Система Redis (Remote Dictionary Service) - это хранилище, в котором данные представлены 
в структуре "ключ-значение". Данные хранятся в памяти и читаются из нее, 
можно настроить срок жизни значений. При этом данные также можно сохранять на диске, 
что обеспечивает их сохранность в последнем состоянии после рестарта.

Для того чтобы определить минусы выбора этой системы, маловато информации в условии. Минусы 
и плюсы скорее выявляются относительно конкретного контекста при наличии альтернативных 
решений. Следует учитывать, что Redis не рассчитан на длительное хранение данных. Если требуется 
долгое хранение консистентных данных, то, конечно, у Redis будут большие минусы в сравнении, 
например, с реляционной СУБД. Но если быть точнее, это не минусы, а вопросы области 
применения. Точно так же в целях кэширования та же реляционная СУБД будет иметь большие 
минусы по сравнению с Redis (т.к. прямо противоречит задачам кэширования, сохраняя 
данные строго на диске).

В заключение, видимо, надо также засвидетельствовать факт ознакомления с понятием pub/sub, 
раз оно тут упомянуто. Pub/sub (publish-subscribe) - это принцип обмена сообщениями, 
в котором есть публикатор (publisher) (один и более) и подписчик (subscriber), ноль и более. 
Важная особенность в том, что публикация и прием сообщений должны 
осуществляться как можно быстрее, то есть с минимальными временными затратами на пути 
между публикатором и подписчиком. У этого принципа существует множество имплементаций. 
Некоторые из них предполагают обязательное наличие брокера сообщений - технического 
посредника, обеспечивающего форматирование, хранение, распределение сообщений. 
Другие, как ZeroMQ в принципе могут обходиться без посредника (хотя могут и 
включать его в систему). 

---
Чтобы не потерять:
- [Разница между БД и брокером сообщений](https://stackoverflow.com/questions/48099098/message-broker-vs-database-and-monitoring)
- [Redis pub/sub implementation](https://redis.io/topics/pubsub)
- [0MQ vision of pub/sub](https://zguide.zeromq.org/docs/chapter1/)